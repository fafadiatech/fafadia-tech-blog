{"componentChunkName":"component---src-templates-index-js","path":"/summary-decorators-a-powerful-weapon-in-your-python-arsenal/","result":{"data":{"site":{"meta":{"title":"Fafadia Tech Blog","description":"Official Blog of Fafadia Tech","url":"http://www.fafadiatech.com","author":"fafadiatech","twitter":"fafadiatechhq``","adsense":""}},"post":{"id":"3e8fda86-47bb-55f7-9db8-afc5ea8fadbc","html":"<p>Source: <a href=\"https://www.youtube.com/watch?v=9oyr0mocZTg\">PyCon 2014</a> on decorators.</p>\n<h2>What is a Decorator?</h2>\n<p>This is what a decorator looks like</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@my_decorator</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">my_awesome_function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<h3>Decorators wrap functions</h3>\n<ol>\n<li>Add functionality</li>\n<li>Modify behavior</li>\n<li>Perform setup/teardown</li>\n<li>Diagnostics {timing, etc}</li>\n</ol>\n<!--more-->\n<h3>What is a function</h3>\n<ul>\n<li>Everything in Python is an object, hence even <strong>functions are objects</strong></li>\n<li>Functions can also create another functions</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># this is called closure</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">make_printer</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> inner\n\np <span class=\"token operator\">=</span> make_printer<span class=\"token punctuation\">(</span><span class=\"token string\">'such wow'</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>Decorators are also closures, they can also be created by classes</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># this is no-op decorator</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">my_decorator</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> inner\n\n\n<span class=\"token comment\"># decorator is called syntactic sugar</span>\n<span class=\"token decorator annotation punctuation\">@my_decorator</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">myfun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>Slightly complicated example</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">shout</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BEFORE\"</span><span class=\"token punctuation\">)</span>\n        ret <span class=\"token operator\">=</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AFTER\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> ret\n    <span class=\"token keyword\">return</span> inner\n\n<span class=\"token decorator annotation punctuation\">@shout</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">myfunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"such wow!\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Output that you will see after calling myfunc is</span>\n<span class=\"token comment\"># >>> myfunc()</span>\n<span class=\"token comment\"># BEFORE</span>\n<span class=\"token comment\"># such wow!</span>\n<span class=\"token comment\"># AFTER</span>\n<span class=\"token comment\"># >>></span></code></pre></div>\n<ul>\n<li>\n<p>Good decorators are versatile</p>\n<ul>\n<li>Allow to re-use functionality across multiple function</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">*args</code> and <code class=\"language-text\">**kwargs</code> together take any number of positional and/or keyword arguments</p>\n<ul>\n<li><code class=\"language-text\">*args</code> as a list</li>\n<li><code class=\"language-text\">**kwargs</code> as dictionary</li>\n</ul>\n</li>\n<li>When we run <code class=\"language-text\">myfunc.__name__</code> it returns <code class=\"language-text\">inner</code></li>\n<li>This can be fixed by adding <code class=\"language-text\">inner.__name__ == wrapped.__name__</code> before <code class=\"language-text\">return inner</code></li>\n</ul>\n<h3>wrapt library</h3>\n<ul>\n<li><a href=\"http://wrapt.readthedocs.io/en/latest/\">wrapt</a> is a nice library that can be used to create decorators</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> wrapt\n\n<span class=\"token decorator annotation punctuation\">@wrapt<span class=\"token punctuation\">.</span>decorator</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">pass_through</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@pass_through</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>Take a note of <code class=\"language-text\">instance</code> variable this allows you to wrap classes and objects</li>\n</ul>\n<h3>Decorators with arguments</h3>\n<p>Here is an example</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">skipIf</span><span class=\"token punctuation\">(</span>conditional<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">dec</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">def</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> conditional<span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> inner\n    <span class=\"token keyword\">return</span> dec\n\n<span class=\"token decorator annotation punctuation\">@skipIf</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'I hate doge'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">myfunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"very print\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Output</span>\n<span class=\"token comment\"># >>> myfunc()</span>\n<span class=\"token comment\"># I hate doge</span></code></pre></div>\n<ul>\n<li>Rewrite of similar functionality with wrapt</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> wrapt\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">with_arguments</span><span class=\"token punctuation\">(</span>myarg1<span class=\"token punctuation\">,</span> myarg2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token decorator annotation punctuation\">@wrapy<span class=\"token punctuation\">.</span>decorator</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">wrapped</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> wrapped\n\n<span class=\"token decorator annotation punctuation\">@with_arguments</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<h3>Counting function calls</h3>\n<p>Following is an example of how to count number of times a function has been called</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        inner<span class=\"token punctuation\">.</span>counter <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        <span class=\"token keyword\">return</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n    inner<span class=\"token punctuation\">.</span>counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">return</span> inner\n\n<span class=\"token decorator annotation punctuation\">@count</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">myfunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<ul>\n<li>Functions are objects, we can define new variable <code class=\"language-text\">counter</code> variable</li>\n</ul>\n<h3>Timing function calls</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">def</span> <span class=\"token function\">timer</span><span class=\"token punctuation\">(</span>wrapped<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        t <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        ret <span class=\"token operator\">=</span> wrapped<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> ret\n    <span class=\"token keyword\">return</span> inner\n\n<span class=\"token decorator annotation punctuation\">@timer</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">myfunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"so example!\"</span><span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"layout":"post","title":"Summary: Decorators - A Powerful Weapon in your Python Arsenal","path":"/summary-decorators-a-powerful-weapon-in-your-python-arsenal/","category":"Technical","tags":["Summary","Python"],"description":"Decorators and Generators are one of the most appealing features of Pythons. Colton Myers gave a talk at PyCon 2014 on decorators. Following is summary of that talk  What is a Decorator? This is what a decorator looks like","date":"2018/11/04","image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABrElEQVQ4y+2Sy1LbQBBF5y+wNA+N3hKy5Yck2xhJsWWJSkGqQuwFLNizSP5/ezMzFISYBVDZZnFqukeq29O3m8RxiO12hbLMkecpimKCqprC910wxiGEMHD+Jz7NX8ekrkv8/HWHtl3i9naPh4cbPD4eMR4noJT+JfIRiO9JxJELao3gOE+Vzs4sjEa2qazRwpZlmztKGWybmnvdgf6mc42OiQxTJOsB8aJGejGAcYHdboX1eq4KOEiSENfXLTabBZqmwmyWKVtyJcaMTfv9hbFptZqZnASTCnl/h/P6Bjq2KcfhR69a/4b6skSWJei6Ne7vv+J4HNAoi/SpfdZCw7DB4dCj7ze4uroEiSMfaSIRhRxJLJGmPizbgiMdpFmEOAlUEQbOhGqJm1dHUaAGeA49UN0258IghAMyn49RlJH6wcN06mOSS3TLFl8WLZpZY1hkc1BGjZj2+Mk7Zk7HORmKESxeC7o4bL9jWPboqh32VYciK0A5exHU5zNvphwEnnq6hzB0DVHomXYppy9wweFKF1LKdyH62aecLvHz8n4E8tnFfXex/wv+M78Bc9Oq5dEHvToAAAAASUVORK5CYII=","aspectRatio":1.3529411764705883,"src":"/blog/static/47b2183183bfb488491cd4a87f78fcc3/46604/Screenshot_2019-05-20_at_8.17.33_PM.png","srcSet":"/blog/static/47b2183183bfb488491cd4a87f78fcc3/62d80/Screenshot_2019-05-20_at_8.17.33_PM.png 125w,\n/blog/static/47b2183183bfb488491cd4a87f78fcc3/e1953/Screenshot_2019-05-20_at_8.17.33_PM.png 250w,\n/blog/static/47b2183183bfb488491cd4a87f78fcc3/46604/Screenshot_2019-05-20_at_8.17.33_PM.png 500w,\n/blog/static/47b2183183bfb488491cd4a87f78fcc3/24ae7/Screenshot_2019-05-20_at_8.17.33_PM.png 644w","sizes":"(max-width: 500px) 100vw, 500px"}}}}}},"pageContext":{}}}