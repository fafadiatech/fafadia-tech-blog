{"componentChunkName":"component---src-templates-index-js","path":"/summary-how-to-be-more-effective-with-functions/","result":{"data":{"site":{"meta":{"title":"Fafadia Tech Blog","description":"Official Blog of Fafadia Tech","url":"http://www.fafadiatech.com","author":"fafadiatech","twitter":"fafadiatechhq``","adsense":""}},"post":{"id":"6cb48beb-6b7b-5995-9130-382874ac388c","html":"<p><a href=\"https://www.safaribooksonline.com/library/view/effective-python-59/9780134034416/\">Effective Python</a> is one the good books that is thought of to be Python 202. Once you’ve got the hang of basics, you’d like to look at ways to improve the code. This is exactly what this books provides.</p>\n<p><a href=\"https://twitter.com/haxor?lang=en\">Bret Saltkin</a> gives a nice talk about this during PyCon 2015, titled <a href=\"https://www.youtube.com/watch?v=WjJUPxKB164\">How to Be More Effective with Functions</a>. Following is summary of that talk</p>\n<h2>Agenda</h2>\n<ol>\n<li>Reduce visual noise with variable positional arguments</li>\n<li>Provide optional behaviour with keyword arguments</li>\n<li>Enforce clarity with keyword-only argument</li>\n<li>Consider generators instead of returning lists</li>\n<li>Be defensive when iterating over arguments</li>\n</ol>\n<!--more-->\n<h2>Reduce visual noise with variable positional arguments</h2>\n<p>This helps reduce visual clutter. Lets look at how the following snippet can be refactored</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> values<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        out <span class=\"token operator\">=</span> <span class=\"token string\">', '</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> values<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'%s: %s'</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nlog<span class=\"token punctuation\">(</span><span class=\"token string\">\"My numbers are\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nlog<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hi there\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Using positional argument we can do it as</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> values<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        out <span class=\"token operator\">=</span> <span class=\"token string\">', '</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> values<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'%s: %s'</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nlog<span class=\"token punctuation\">(</span><span class=\"token string\">\"My numbers are\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\nlog<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hi there\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Alternative syntax to achieve same</span>\n<span class=\"token comment\"># thing</span>\nnums <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\nlog<span class=\"token punctuation\">(</span><span class=\"token string\">\"My numbers are\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>nums<span class=\"token punctuation\">)</span></code></pre></div>\n<p>This technique will not work with generators.</p>\n<p>In summary:</p>\n<ol>\n<li>Good for removing noise</li>\n<li>Make your code more readable</li>\n<li>Not for all APIs that accept sequence</li>\n<li>Convenience for programmer</li>\n</ol>\n<h2>Provide optional behaviour with keyword arguments</h2>\n<p>Lets say we have following function</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">flow_rate</span><span class=\"token punctuation\">(</span>weight_diff<span class=\"token punctuation\">,</span> time_diff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> weight_diff <span class=\"token operator\">/</span> time_diff</code></pre></div>\n<p>Now lets say we want to add extra functionality without affecting existing function calls we can do so by refactoring</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">flow_rate</span><span class=\"token punctuation\">(</span>weight_diff<span class=\"token punctuation\">,</span> time_diff<span class=\"token punctuation\">,</span> period<span class=\"token operator\">=</span><span class=\"token number\">3600</span><span class=\"token punctuation\">,</span> units_per_kg<span class=\"token operator\">=</span><span class=\"token number\">2.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>Note how <code class=\"language-text\">period</code> and <code class=\"language-text\">units_per_kg</code> are optional arguments that can be used for calculations</p>\n<p>In summary:</p>\n<ol>\n<li>Omit arguments you don’t need</li>\n<li>New usage can access new functionality</li>\n<li>No need to update existing callers</li>\n</ol>\n<h2>Enforce clarity with keyword-only argument</h2>\n<p>In the functions definition above, you’re not really sure which one comes first, and which are optional {while making the call}. To solve this problem</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">flow_rate</span><span class=\"token punctuation\">(</span>weight_diff<span class=\"token punctuation\">,</span> time_diff<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> period<span class=\"token operator\">=</span><span class=\"token number\">3600</span><span class=\"token punctuation\">,</span> units_per_kg<span class=\"token operator\">=</span><span class=\"token number\">2.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>weight_diff <span class=\"token operator\">*</span> units_per_kg<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>time_diff <span class=\"token operator\">*</span> period<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Note the <code class=\"language-text\">*</code>, {BTW this is support for Python 3+}. What this implies is anything after <code class=\"language-text\">*</code> will be specified as keyword argument.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">flow <span class=\"token operator\">=</span> flow_rate<span class=\"token punctuation\">(</span>weight_diff<span class=\"token punctuation\">,</span> time_diff<span class=\"token punctuation\">,</span> period<span class=\"token operator\">=</span><span class=\"token number\">60</span><span class=\"token punctuation\">,</span> units_per_kg<span class=\"token operator\">=</span><span class=\"token number\">35.274</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This is how the function will be getting executed, Optional arguments must use keywords</p>\n<p>In summary:</p>\n<ol>\n<li>Require clarity for optional arguments</li>\n<li>Critically important for arguments of the same type {boolean flags, numbers}</li>\n<li>Best way to extend *args functions</li>\n</ol>\n<h2>Consider generators instead of returning lists</h2>\n<p>The default way to implement things should be generators as opposed to list. To understand lets take a look at following snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">load_cities_list</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    out <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> handle<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> handle<span class=\"token punctuation\">:</span>\n            city<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span>\n            out<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>city<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> out</code></pre></div>\n<p>Some issues with the above snippet: You might run out of memory {where there is a huge file}. This can be re-written using following</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">load_cities_list</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> handle<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> handle<span class=\"token punctuation\">:</span>\n            city<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">yield</span> city<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span></code></pre></div>\n<p>In summary:</p>\n<ol>\n<li>Less noise, easier to read</li>\n<li>File can be arbitrary size</li>\n<li>Memory problems are gone</li>\n</ol>\n<h2>Be defensive when iterating over arguments</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>pop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    total <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>x <span class=\"token keyword\">for</span> _<span class=\"token punctuation\">,</span> x <span class=\"token keyword\">in</span> pop<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> city<span class=\"token punctuation\">,</span> count <span class=\"token keyword\">in</span> pop<span class=\"token punctuation\">:</span>\n        percent <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token operator\">*</span> count <span class=\"token operator\">/</span> total\n        <span class=\"token keyword\">yield</span> city<span class=\"token punctuation\">,</span> percent</code></pre></div>\n<p>If you run the above code it will return <code class=\"language-text\">StopIteration</code> exception. This is because we’re iterating twice over pop.</p>\n<p>This can be refactored into iterable container.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">LoadCities</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> path\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__iter__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> handle<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> handle<span class=\"token punctuation\">:</span>\n                city<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">yield</span> city<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span></code></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>pop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    total <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>x <span class=\"token keyword\">for</span> _<span class=\"token punctuation\">,</span> x <span class=\"token keyword\">in</span> pop__iter__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> city<span class=\"token punctuation\">,</span> count <span class=\"token keyword\">in</span> pop<span class=\"token punctuation\">.</span>__iter__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        percent <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token operator\">*</span> count <span class=\"token operator\">/</span> total\n        <span class=\"token keyword\">yield</span> city<span class=\"token punctuation\">,</span> percent</code></pre></div>\n<p>Note the extra <code class=\"language-text\">__iter__()</code></p>\n<p>In summary:</p>\n<ol>\n<li>Beware of multiple iterations over the same argument</li>\n<li>Define and use containers to avoid the problem entirely</li>\n<li>Use <code class=\"language-text\">iter(x) is iter(x)</code> to detect non-container</li>\n<li>Know the iterator protocol</li>\n</ol>","frontmatter":{"layout":"post","title":"Summary: How to Be More Effective with Functions","path":"/summary-how-to-be-more-effective-with-functions/","category":"Technical","tags":["Summary","Python"],"description":"Functions are basic constructs of programming language. This blog post we will show how to use them more effectively","date":"2018/01/15","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIDBP/aAAwDAQACEAMQAAABkcutAQxy/8QAGRAAAgMBAAAAAAAAAAAAAAAAAQIAAxAR/9oACAEBAAEFAqlQitUzsGf/xAAYEQACAwAAAAAAAAAAAAAAAAABAhARIf/aAAgBAwEBPwEMorI//8QAFhEAAwAAAAAAAAAAAAAAAAAAEBJh/9oACAECAQE/AVo//8QAFxAAAwEAAAAAAAAAAAAAAAAAARASAP/aAAgBAQAGPwI1jSL/AP/EABsQAAIDAAMAAAAAAAAAAAAAAAEhABExEGFx/9oACAEBAAE/IWQv2EB+0HFZ0i1ASdwqK4//2gAMAwEAAgADAAAAEK/f/8QAGREAAwADAAAAAAAAAAAAAAAAABEhATFh/9oACAEDAQE/ELh1vpmn/8QAGREAAgMBAAAAAAAAAAAAAAAAACEBEXGh/9oACAECAQE/EJtbPmDg/8QAGhABAQEBAQEBAAAAAAAAAAAAAREhAFExgf/aAAgBAQABPxCIWGARD3oocwRnvMEAlWmfnBAYEcmhNnJHKa/Gd//Z","aspectRatio":1.7877094972067038,"src":"/blog/static/a967244f19251efaadc337a8fac0a20b/0f3a1/artificial-intelligence-3513224_640.jpg","srcSet":"/blog/static/a967244f19251efaadc337a8fac0a20b/1ada3/artificial-intelligence-3513224_640.jpg 125w,\n/blog/static/a967244f19251efaadc337a8fac0a20b/8f7df/artificial-intelligence-3513224_640.jpg 250w,\n/blog/static/a967244f19251efaadc337a8fac0a20b/0f3a1/artificial-intelligence-3513224_640.jpg 500w,\n/blog/static/a967244f19251efaadc337a8fac0a20b/f422e/artificial-intelligence-3513224_640.jpg 640w","sizes":"(max-width: 500px) 100vw, 500px"}}}}}},"pageContext":{}}}