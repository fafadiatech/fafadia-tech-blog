{"componentChunkName":"component---src-templates-index-js","path":"/download-nse-bse-bhavcopies-in-python-using-click/","result":{"data":{"site":{"meta":{"title":"Fafadia Tech Blog","description":"Official Blog of Fafadia Tech","url":"http://www.fafadiatech.com","author":"fafadiatech","twitter":"fafadiatechhq``","adsense":""}},"post":{"id":"26ffd1da-afc1-5b54-8a1e-8ad36f48351d","html":"<p>What are <a href=\"https://www.quora.com/What-are-the-BHAV-copy-reports-of-NSE\">Bhav Copies?</a></p>\n<!--more-->\n<p>For complete code <a href=\"https://raw.githubusercontent.com/fafadiatech/ft-learnings/master/python/click/download_bhavcopy.py\">review this python script</a>, the heart of the code is listed as below:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@click<span class=\"token punctuation\">.</span>command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator annotation punctuation\">@click<span class=\"token punctuation\">.</span>argument</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"exchange\"</span><span class=\"token punctuation\">,</span>\n    default<span class=\"token operator\">=</span><span class=\"token string\">\"nse\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator annotation punctuation\">@click<span class=\"token punctuation\">.</span>option</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"--for_date\"</span><span class=\"token punctuation\">,</span>\n    default<span class=\"token operator\">=</span>yesterday<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Date for which to download bhavcopy DD/MM/YYYY format\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator annotation punctuation\">@click<span class=\"token punctuation\">.</span>option</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"--for_past_days\"</span><span class=\"token punctuation\">,</span>\n    default<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Number of calendar days for which we need to fetch data {E.g. past 15 days from today}\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> for_date<span class=\"token punctuation\">,</span> for_past_days<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    download_bhavcopy is utility that will download daily bhav copies\n    from NSE and BSE\n\n    Examples:\n    python download_bhavcopy.py bse --for_date 06/12/2017\n\n    python download_bhavcopy.py bse --for_past_days 15\n    \"\"\"</span>\n    click<span class=\"token punctuation\">.</span>echo<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"downloading bhavcopy </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>exchange<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># We need to fetch data for past X days</span>\n    <span class=\"token keyword\">if</span> for_past_days <span class=\"token operator\">!=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>for_past_days<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            ts <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> timedelta<span class=\"token punctuation\">(</span>days<span class=\"token operator\">=</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            ts <span class=\"token operator\">=</span> ts<span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">\"%d/%m/%Y\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> exchange <span class=\"token operator\">==</span> <span class=\"token string\">\"nse\"</span><span class=\"token punctuation\">:</span>\n                download_nse_bhavcopy<span class=\"token punctuation\">(</span>ts<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                download_bse_bhavcopy<span class=\"token punctuation\">(</span>ts<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> exchange <span class=\"token operator\">==</span> <span class=\"token string\">\"nse\"</span><span class=\"token punctuation\">:</span>\n            download_nse_bhavcopy<span class=\"token punctuation\">(</span>for_date<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            download_bse_bhavcopy<span class=\"token punctuation\">(</span>for_date<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Key things to note:</p>\n<ol>\n<li>You can take any python function and decorate it with <code class=\"language-text\">@click.command</code> to make it behave like a command line interface. What this means is you get <code class=\"language-text\">--help</code> flag out of the box.</li>\n<li>\n<p>Click has two key concepts around parameters going into <code class=\"language-text\">main</code> function here:</p>\n<ol>\n<li>Argument: These are mandatory. Look at how we’ve made <code class=\"language-text\">exchange</code> a mandatory parameter</li>\n<li>Options: These are parameters/switch that can or cannot be present. Both <code class=\"language-text\">for_date</code> and <code class=\"language-text\">for_days</code> are example of optional arguments</li>\n</ol>\n</li>\n<li>The document string that you write below the function that you’ve decorated using <code class=\"language-text\">@click.command</code> will be printed when you invoke the command with <code class=\"language-text\">--help</code> flag. We believe this is one of the most awesome features</li>\n<li>With optional arguments you can specify <code class=\"language-text\">help</code> which also produces nicer output</li>\n<li>You can also use <code class=\"language-text\">default</code> argument in <code class=\"language-text\">@click.option</code> decorator to specify default values. This is also used to infer data-type of argument. Thus we don’t need to do all parsing and validation.</li>\n<li>Click also has <a href=\"http://click.pocoo.org/6/commands/\">Sub Commands</a> this make grouping and implementing sub-commands real easy</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">(click_demo) Sidharths-MacBook-Pro-3:click sidharthshah$ python download_bhavcopy.py --help\nUsage: download_bhavcopy.py [OPTIONS] [EXCHANGE]\n\n  download_bhavcopy is utility that will download daily bhav copies from NSE\n  and BSE\n\n  Examples: python download_bhavcopy.py bse --for_date 06/12/2017\n\n  python download_bhavcopy.py bse --for_past_days 15\n\nOptions:\n  --for_date TEXT          Date for which to download bhavcopy DD/MM/YYYY\n                           format\n  --for_past_days INTEGER  Number of calendar days for which we need to fetch\n                           data {E.g. past 15 days from today}\n  --help                   Show this message and exit.</code></pre></div>\n<p>For reference you can look at <a href=\"https://www.youtube.com/watch?v=kNke39OZ2k0\">Awesome Screencast on YouTube</a> and <a href=\"http://click.pocoo.org/6/commands/\">Official Documentation</a></p>","frontmatter":{"layout":"post","title":"Download NSE & BSE Bhavcopies in Python using Click","path":"/download-nse-bse-bhavcopies-in-python-using-click/","category":"Technical","tags":["Python"],"description":"One of the key selling points of Python is ability to create command line script that have ability to automate some mundane tasks. Bhav Copies are equivalent to data feeds we get from exchanges. We wanted to demonstrate power of simple scripts, so we chose","date":"2018/01/16","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAHIRy0xf//EABUQAQEAAAAAAAAAAAAAAAAAABAB/9oACAEBAAEFAmv/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFX/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQQREhMf/aAAgBAQABPyG4ZoyzHD//2gAMAwEAAgADAAAAELAP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EGI//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERMf/aAAgBAgEBPxB4VH//xAAdEAACAgEFAAAAAAAAAAAAAAAAAREhcTFBUWHB/9oACAEBAAE/ENI8MS2yhryWD0Qabo//2Q==","aspectRatio":1.5023474178403755,"src":"/blog/static/f46f885382cf2a6fbdbdd5e9a43fa0df/0f3a1/business-1730089_640.jpg","srcSet":"/blog/static/f46f885382cf2a6fbdbdd5e9a43fa0df/1ada3/business-1730089_640.jpg 125w,\n/blog/static/f46f885382cf2a6fbdbdd5e9a43fa0df/8f7df/business-1730089_640.jpg 250w,\n/blog/static/f46f885382cf2a6fbdbdd5e9a43fa0df/0f3a1/business-1730089_640.jpg 500w,\n/blog/static/f46f885382cf2a6fbdbdd5e9a43fa0df/f422e/business-1730089_640.jpg 640w","sizes":"(max-width: 500px) 100vw, 500px"}}}}}},"pageContext":{}}}